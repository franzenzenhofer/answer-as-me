{"version":3,"file":"google-docs-prompts.js","sourceRoot":"","sources":["../../../src/modules/google-docs-prompts.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Google Docs Prompts System\n * \n * HARDCORE DRY PRINCIPLE:\n * - Each prompt type has its own Google Doc\n * - Google Docs are the SINGLE SOURCE OF TRUTH\n * - No hardcoded prompts in the codebase\n * - Docs persist after factory reset\n * - Complete decoupling from application code\n */\n\nnamespace GoogleDocsPrompts {\n  export interface PromptDocument {\n    id: string;\n    type: string;\n    version: string;\n    lastModified: GoogleAppsScript.Base.Date;\n    content: string;\n    url: string;\n  }\n\n  export interface PromptCache {\n    [promptType: string]: {\n      document: PromptDocument;\n      cachedAt: GoogleAppsScript.Base.Date;\n    };\n  }\n\n  export interface PromptStatus {\n    type: string;\n    hasDoc: boolean;\n    docId: string | null;\n    version: string;\n    lastChecked: GoogleAppsScript.Base.Date;\n    hasUpdate: boolean;\n    url: string | null;\n  }\n\n  /**\n   * Get or create a prompt document for a specific type - ALWAYS CREATES IMMEDIATELY\n   */\n  export function getOrCreatePromptDocument(promptType: string): string {\n    const startTime = Date.now();\n    DebugLogger.logLogic('getOrCreatePromptDocument', 'START', { promptType });\n    \n    // Validate prompt type to prevent injection\n    if (!promptType || typeof promptType !== 'string' || promptType.length > 50) {\n      const error = 'Invalid prompt type';\n      DebugLogger.logError('GoogleDocsPrompts', error, { promptType });\n      throw new Error(error);\n    }\n    \n    // Only allow known prompt types \n    const knownTypes = Object.values(Constants.PROMPTS.TYPES);\n    if (!knownTypes.includes(promptType)) {\n      const error = 'Invalid prompt type format';\n      DebugLogger.logError('GoogleDocsPrompts', error, { promptType, knownTypes });\n      throw new Error(error);\n    }\n    \n    const docIdKey = `${Constants.PROMPTS.DOC_ID_PREFIX}${promptType}`;\n    let docId = PropertyManager.getProperty(docIdKey, 'user');\n    let created = false;\n\n    // ALWAYS CREATE IF DOESN'T EXIST - NO DELAYS!\n    if (!docId) {\n      try {\n        DebugLogger.info('GoogleDocsPrompts', `Creating new prompt document for ${promptType}`);\n        \n        // Create new document with sanitized title\n        const docName = Constants.PROMPTS.DOC_NAMES[promptType] || promptType;\n        const sanitizedDocName = docName\n          .replace(/[^a-zA-Z0-9\\s\\-_]/g, '') // Remove special characters\n          .substring(0, 100); // Limit length\n        \n        if (!sanitizedDocName.trim()) {\n          throw new Error('Invalid prompt type name');\n        }\n        \n        const title = `${Constants.PROMPTS.DOC_TITLE_PREFIX} ${sanitizedDocName}`;\n        DebugLogger.debug('GoogleDocsPrompts', `Creating doc with title: ${title}`);\n        \n        const doc = DocumentApp.create(title);\n        docId = doc.getId();\n        created = true;\n        \n        // Set initial content from template\n        const body = doc.getBody();\n        const template = getPromptTemplate(promptType);\n        body.setText(template);\n        \n        // Style the document\n        styleDocument(body);\n        \n        // Save document ID with thread safety\n        PropertyManager.setProperty(docIdKey, docId, 'user');\n        \n        // Make it accessible to user\n        const file = DriveApp.getFileById(docId);\n        file.setSharing(DriveApp.Access.PRIVATE, DriveApp.Permission.EDIT);\n        \n        // Move to a dedicated folder\n        createPromptsFolderIfNeeded(file);\n        \n        const duration = Date.now() - startTime;\n        DebugLogger.logLogic('getOrCreatePromptDocument', 'CREATED', \n          { promptType, docId, title }, \n          { docId, created: true },\n          'Successfully created new prompt document',\n          duration\n        );\n        \n        AppLogger.info('Created prompt document', { promptType, docId, title });\n      } catch (error) {\n        const duration = Date.now() - startTime;\n        DebugLogger.logError('GoogleDocsPrompts', error instanceof Error ? error : String(error), { promptType }, 'Failed to create prompt document - user cannot customize prompts');\n        DebugLogger.logLogic('getOrCreatePromptDocument', 'ERROR', { promptType }, null, 'Failed to create document', duration);\n        AppLogger.error('Failed to create prompt document', { promptType, error });\n        throw new Error(`${Constants.ERRORS.PROMPT_DOC_CREATE_FAILED}: ${promptType}`);\n      }\n    } else {\n      // Document exists - verify it's still accessible\n      try {\n        const doc = DocumentApp.openById(docId);\n        const title = doc.getName();\n        DebugLogger.debug('GoogleDocsPrompts', `Using existing document: ${title}`, { docId });\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      } catch (_error) {\n        // Document exists in properties but is inaccessible - recreate it\n        DebugLogger.warn('GoogleDocsPrompts', 'Existing document inaccessible, recreating', { docId, promptType });\n        PropertyManager.deleteProperty(docIdKey, 'user');\n        return getOrCreatePromptDocument(promptType); // Recursive call to create new one\n      }\n    }\n\n    const duration = Date.now() - startTime;\n    DebugLogger.logLogic('getOrCreatePromptDocument', 'COMPLETE', \n      { promptType }, \n      { docId, created },\n      created ? 'Created new document' : 'Using existing document',\n      duration\n    );\n\n    return docId;\n  }\n\n  /**\n   * Create ALL prompt documents immediately - KISS approach\n   */\n  export function createAllPromptDocuments(): { [key: string]: string } {\n    DebugLogger.logLogic('createAllPromptDocuments', 'START', null);\n    const startTime = Date.now();\n    const results: { [key: string]: string } = {};\n    \n    // Create all 3 prompt types immediately\n    const promptTypes = Object.values(Constants.PROMPTS.TYPES);\n    \n    for (const promptType of promptTypes) {\n      try {\n        DebugLogger.info('GoogleDocsPrompts', `Creating prompt document: ${promptType}`);\n        const docId = getOrCreatePromptDocument(promptType);\n        results[promptType] = docId;\n        DebugLogger.debug('GoogleDocsPrompts', `Created ${promptType} document`, { docId });\n      } catch (error) {\n        DebugLogger.logError('GoogleDocsPrompts', error instanceof Error ? error : String(error), { promptType }, `Failed to create ${promptType} document`);\n        results[promptType] = '';\n      }\n    }\n    \n    const duration = Date.now() - startTime;\n    const successCount = Object.values(results).filter(id => id).length;\n    \n    DebugLogger.logLogic('createAllPromptDocuments', 'COMPLETE', \n      { promptTypes }, \n      results,\n      `Created ${successCount}/${promptTypes.length} prompt documents`,\n      duration\n    );\n    \n    return results;\n  }\n\n  /**\n   * Create and organize prompts folder\n   */\n  function createPromptsFolderIfNeeded(file: GoogleAppsScript.Drive.File): void {\n    try {\n      const folderName = 'Answer As Me - Prompt Documents';\n      const folders = DriveApp.getFoldersByName(folderName);\n      \n      let folder: GoogleAppsScript.Drive.Folder;\n      if (folders.hasNext()) {\n        folder = folders.next();\n      } else {\n        folder = DriveApp.createFolder(folderName);\n        folder.setDescription('Editable prompt templates for Answer As Me Gmail add-on');\n      }\n      \n      folder.addFile(file);\n      // Remove from root if possible\n      try {\n        DriveApp.getRootFolder().removeFile(file);\n      } catch {\n        // Ignore if can't remove from root\n      }\n    } catch (error) {\n      AppLogger.error('Failed to organize prompt folder', error);\n    }\n  }\n\n  /**\n   * Fetch a specific prompt from its document\n   */\n  export function fetchPrompt(promptType: string, forceRefresh = false): PromptDocument {\n    try {\n      // Check cache first\n      if (!forceRefresh) {\n        const cached = getCachedPrompt(promptType);\n        if (cached && isCacheValid(cached.cachedAt)) {\n          AppLogger.info('Using cached prompt', { promptType, version: cached.document.version });\n          return cached.document;\n        }\n      }\n\n      // Get or create document\n      const docId = getOrCreatePromptDocument(promptType);\n      const doc = DocumentApp.openById(docId);\n      const content = doc.getBody().getText();\n      const file = DriveApp.getFileById(docId);\n      const lastModified = file.getLastUpdated();\n      const url = doc.getUrl();\n\n      // Extract version\n      const version = extractVersion(content) || Constants.PROMPTS.DEFAULT_VERSION;\n\n      const document: PromptDocument = {\n        id: docId,\n        type: promptType,\n        version,\n        lastModified,\n        content: cleanPromptContent(content),\n        url\n      };\n\n      // Update cache\n      updateCache(promptType, document);\n\n      // Store version for comparison with thread safety\n      const versionKey = `${Constants.PROMPTS.VERSION_PREFIX}${promptType}`;\n      PropertyManager.setProperty(versionKey, version, 'user');\n\n      AppLogger.info('Fetched prompt from document', { promptType, version });\n      return document;\n    } catch (error) {\n      AppLogger.error('Failed to fetch prompt', { promptType, error });\n      \n      // Return minimal fallback\n      return getMinimalFallback(promptType);\n    }\n  }\n\n  /**\n   * Get all prompt statuses\n   */\n  export function getAllPromptStatuses(): PromptStatus[] {\n    const statuses: PromptStatus[] = [];\n    const properties = PropertyManager.getAllProperties('user');\n    \n    for (const typeName of Object.values(Constants.PROMPTS.TYPES)) {\n      const docIdKey = `${Constants.PROMPTS.DOC_ID_PREFIX}${typeName}`;\n      const versionKey = `${Constants.PROMPTS.VERSION_PREFIX}${typeName}`;\n      const docId = properties[docIdKey];\n      \n      const status: PromptStatus = {\n        type: typeName,\n        hasDoc: !!docId,\n        docId: docId || null,\n        version: properties[versionKey] || Constants.PROMPTS.DEFAULT_VERSION,\n        lastChecked: new Date() as GoogleAppsScript.Base.Date,\n        hasUpdate: false,\n        url: null\n      };\n      \n      if (docId) {\n        try {\n          const doc = DocumentApp.openById(docId);\n          status.url = doc.getUrl();\n          \n          // Check for updates\n          const file = DriveApp.getFileById(docId);\n          const cached = getCachedPrompt(typeName);\n          if (cached && file.getLastUpdated() > cached.cachedAt) {\n            status.hasUpdate = true;\n          }\n        } catch (error) {\n          AppLogger.error('Error checking prompt status', { type: typeName, error });\n        }\n      }\n      \n      statuses.push(status);\n    }\n    \n    return statuses;\n  }\n\n  /**\n   * Update all prompts that have changes\n   */\n  export function updateAllPrompts(): { updated: string[]; failed: string[] } {\n    const result = { updated: [] as string[], failed: [] as string[] };\n    \n    for (const typeName of Object.values(Constants.PROMPTS.TYPES)) {\n      try {\n        fetchPrompt(typeName, true);\n        result.updated.push(typeName);\n      } catch (error) {\n        result.failed.push(typeName);\n        AppLogger.error('Failed to update prompt', { type: typeName, error });\n      }\n    }\n    \n    return result;\n  }\n\n  /**\n   * Get prompt with variable substitution\n   */\n  export function getPrompt(\n    promptType: string,\n    variables: { [key: string]: string } = {}\n  ): string {\n    // Always force refresh to ensure we use the latest document content\n    const doc = fetchPrompt(promptType, true);\n    let content = doc.content;\n    \n    // Replace variables\n    for (const [key, value] of Object.entries(variables)) {\n      const regex = new RegExp(`{{${key}}}`, 'g');\n      content = content.replace(regex, value);\n    }\n    \n    return content;\n  }\n\n  /**\n   * Clean prompt content (remove metadata sections)\n   */\n  function cleanPromptContent(content: string): string {\n    // Remove version header and metadata\n    return content\n      .replace(/^## Version:.*$/m, '')\n      .replace(/^## Last Updated:.*$/m, '')\n      .replace(/^## Description:.*$/m, '')\n      .replace(/^---+$/gm, '')\n      .trim();\n  }\n\n  /**\n   * Extract version from document\n   */\n  function extractVersion(content: string): string | null {\n    const match = content.match(/^## Version:\\s*(.+)$/m);\n    return match && match[1] ? match[1].trim() : null;\n  }\n\n  /**\n   * Style the document\n   */\n  function styleDocument(body: GoogleAppsScript.Document.Body): void {\n    const style: {[key: string]: any} = {};\n    style[DocumentApp.Attribute.FONT_FAMILY as unknown as string] = 'Arial';\n    style[DocumentApp.Attribute.FONT_SIZE as unknown as string] = 11;\n    style[DocumentApp.Attribute.LINE_SPACING as unknown as string] = 1.5;\n    body.setAttributes(style);\n  }\n\n  /**\n   * Get template for a prompt type\n   */\n  function getPromptTemplate(promptType: string): string {\n    const header = `## Version: ${Constants.PROMPTS.DEFAULT_VERSION}\n## Last Updated: ${new Date().toISOString()}\n## Description: ${Constants.PROMPTS.DOC_NAMES[promptType] || promptType} Prompt Template\n\n---\n\n`;\n\n    const templates: { [key: string]: string } = {\n      SETTINGS: `${header}You are the personal email assistant for {{userName}} ({{userEmail}}).\n\nYOUR IDENTITY & SETTINGS:\n- You work exclusively for {{userName}} ({{userEmail}})\n- You know their communication style from analyzing their emails\n- You draft responses as if you were them, not as an AI\n- You understand their role, relationships, and communication patterns\n- You maintain their professional reputation in every response\n\nKEY INSTRUCTIONS:\n- Write in first person as {{userName}}\n- Never reveal you are an AI assistant\n- Adapt tone based on recipient and context\n- Use their typical vocabulary and expressions\n- Mirror their level of formality/informality\n\nCUSTOM SETTINGS:\nYou can customize these settings below:\n- Default formality level\n- Typical greetings and closings\n- Professional role and expertise\n- Special instructions for all emails\n- Email signature preferences\n\nEdit this document to customize the assistant's behavior and identity.`,\n\n      OVERVIEW: `${header}Generate an email response based on the following context:\n\n**EMAIL CONTEXT:**\n{{context}}\n\n**YOUR IDENTITY:**\n{{identity}}\n\n**WRITING STYLE:**\n{{style}}\n\n**RECIPIENT RELATIONSHIP:**\n{{recipientInfo}}\n\n**SPECIAL INSTRUCTIONS:**\n{{instructions}}\n\nRESPONSE REQUIREMENTS:\n1. Write as {{userName}}, not about them\n2. Match their typical tone for this recipient type\n3. Use appropriate greeting and closing from their patterns\n4. Maintain their vocabulary and expression style\n5. Keep consistent with their email length preferences\n6. Apply any special instructions provided\n7. Generate a complete email response ready to send\n\nCUSTOMIZATION:\nYou can edit this document to change how responses are generated:\n- Add specific response templates\n- Modify the tone and style guidelines\n- Include industry-specific language preferences\n- Add context-specific instructions`,\n\n      THREAD: `${header}Analyze email threads and learn communication patterns for {{userEmail}}.\n\n**CURRENT ANALYSIS CONTEXT:**\n{{threadContent}}\n\n**USER PROFILE:**\n{{currentProfile}}\n\n**THREAD MESSAGES:**\n{{threadMessages}}\n\nANALYSIS TASKS:\n1. **Style Analysis**: Extract greetings, closings, tone patterns\n2. **Relationship Dynamics**: Understand communication with different recipients\n3. **Vocabulary Patterns**: Common phrases and expressions used\n4. **Context Adaptation**: How style changes based on situation\n5. **Learning Integration**: Update understanding based on new examples\n\nLEARNING OUTPUTS:\n- Communication patterns specific to this context\n- Vocabulary or phrases not previously captured\n- Tone adaptations for this recipient/situation\n- Unique stylistic elements to remember\n\nCUSTOMIZATION:\nEdit this document to control how the assistant learns from your emails:\n- Focus areas for style analysis\n- Specific patterns to watch for\n- Recipients to treat differently\n- Context-specific learning rules`\n    };\n\n    return templates[promptType] || `${header}[Template for ${promptType} - Please customize this prompt]`;\n  }\n\n  /**\n   * Get minimal fallback for a prompt type\n   */\n  function getMinimalFallback(promptType: string): PromptDocument {\n    AppLogger.warn(Constants.PROMPTS.FALLBACK_WARNING, { promptType });\n    \n    const fallbacks: { [key: string]: string } = {\n      ASSISTANT_IDENTITY: 'You are an email assistant. Help draft responses.',\n      STYLE_ANALYSIS: 'Analyze the writing style of the provided emails.',\n      RESPONSE_GENERATION: 'Generate an email response based on the context: {{context}}',\n      STYLE_IMPROVEMENT: 'Improve the writing style based on the thread.',\n      THREAD_LEARNING: 'Learn from the email thread.',\n      ERROR_CONTEXT: 'An error occurred. Please try again.'\n    };\n\n    return {\n      id: 'fallback',\n      type: promptType,\n      version: 'fallback',\n      lastModified: new Date(),\n      content: fallbacks[promptType] || 'Fallback prompt',\n      url: ''\n    };\n  }\n\n  /**\n   * Cache management\n   */\n  function getCachedPrompt(\n    promptType: string\n  ): { document: PromptDocument; cachedAt: GoogleAppsScript.Base.Date } | null {\n    try {\n      const cacheKey = `${Constants.PROMPTS.CACHE_PREFIX}${promptType}`;\n      const cached = PropertyManager.getProperty(cacheKey, 'user');\n      if (!cached) {\n        return null;\n      }\n      \n      const data = JSON.parse(cached);\n      // Validate cache structure\n      if (!data.document || !data.cachedAt) {\n        AppLogger.warn('Invalid cache structure', { promptType });\n        return null;\n      }\n      \n      return {\n        document: data.document,\n        cachedAt: new Date(data.cachedAt)\n      };\n    } catch (error) {\n      AppLogger.warn('Failed to parse cached prompt', { promptType, error });\n      // Clear corrupted cache\n      try {\n        const cacheKey = `${Constants.PROMPTS.CACHE_PREFIX}${promptType}`;\n        PropertyManager.deleteProperty(cacheKey, 'user');\n      } catch {}\n      return null;\n    }\n  }\n\n  function updateCache(promptType: string, document: PromptDocument): void {\n    try {\n      const cacheKey = `${Constants.PROMPTS.CACHE_PREFIX}${promptType}`;\n      const data = {\n        document,\n        cachedAt: new Date(),\n        cacheVersion: Utilities.getUuid() // Add cache version for invalidation tracking\n      };\n      PropertyManager.setProperty(cacheKey, JSON.stringify(data), 'user');\n    } catch (error) {\n      AppLogger.error('Failed to update prompt cache', { promptType, error });\n    }\n  }\n\n  function isCacheValid(cachedAt: GoogleAppsScript.Base.Date): boolean {\n    const age = Date.now() - (cachedAt as any).getTime();\n    return age < Constants.TIMING.PROMPT_CACHE_TTL;\n  }\n\n  /**\n   * Check for automatic updates\n   */\n  export function checkForAutomaticUpdates(): void {\n    if (!Constants.PROMPTS.AUTO_CHECK_ENABLED) {\n      return;\n    }\n    \n    const lastCheckKey = Constants.PROPERTIES.PROMPTS_LAST_CHECK;\n    const lastCheck = PropertyManager.getProperty(lastCheckKey, 'user');\n    \n    if (lastCheck) {\n      const timeSinceCheck = Date.now() - parseInt(lastCheck);\n      if (timeSinceCheck < Constants.TIMING.PROMPT_UPDATE_CHECK_INTERVAL) {\n        return;\n      }\n    }\n    \n    // Check all prompts for updates\n    const statuses = getAllPromptStatuses();\n    const hasUpdates = statuses.some(s => s.hasUpdate);\n    \n    if (hasUpdates) {\n      AppLogger.info('Prompt updates available', { \n        types: statuses.filter(s => s.hasUpdate).map(s => s.type) \n      });\n    }\n    \n    PropertyManager.setProperty(lastCheckKey, Date.now().toString(), 'user');\n  }\n}"]}